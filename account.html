<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Кабинет — ResumeHelper</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
  <div class="header-left">
    <div class="brand">ResumeHelper</div>
    <nav class="main-nav">
      <a href="index.html">Главная</a>
      <a href="services.html">Услуги</a>
      <a href="tools.html">Инструменты</a>
      <a href="materials.html">Материалы</a>
      <a href="account.html" class="active">Кабинет</a>
      <a href="reviews.html">Отзывы</a>
    </nav>
    <div class="auth-buttons"></div>
  </div>
</header>

<main class="container">
  <h1 class="page-title">Личный кабинет</h1>
  <p class="lead">Здесь собрана ваша статистика и сохранённые материалы.</p>

  <div id="notAuth" class="card" style="display:none;margin-top:18px;">
    <h2 class="page-title-medium">Вы не авторизованы</h2>
    <p>Чтобы открыть личный кабинет, пожалуйста войдите или зарегистрируйтесь.</p>
    <button class="btn-primary" onclick="auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())">Войти через Google</button>
  </div>

  <div id="userInfo" class="card" style="display:none;margin-top:18px;">
    <h2 class="page-title-medium" style="margin-bottom:6px;">Профиль</h2>

    <div style="display:flex;align-items:center;gap:18px;margin-top:12px;flex-wrap:wrap">
      <img id="userPhoto" src="" alt="" style="width:72px;height:72px;border-radius:50%;object-fit:cover;background:#eee">
      <div>
        <div id="userName" style="font-size:18px;font-weight:600;margin-bottom:4px;">—</div>
        <div id="userEmail" style="color:#6b6b6b;font-size:14px;">—</div>
      </div>
    </div>

    <div style="margin-top:20px;border-top:1px solid #f2f2f2;padding-top:16px;">
      <h3 class="page-title-medium" style="margin-bottom:6px;">Статистика</h3>
      <p style="margin:6px 0;">Документы: <strong id="docCount">0</strong></p>
      <p style="margin:6px 0;">Шаблоны: <strong id="tplCount">0</strong></p>
    </div>

    <div style="margin-top:20px;">
      <h3 class="page-title-medium" style="margin-bottom:6px;">Действия</h3>
      <button class="btn-primary" onclick="editProfile()">Редактировать профиль</button>
    </div>

  </div>
</main>

<footer class="footer container">
  © 2025 ResumeHelper
</footer>

<!-- Firebase + Auth -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="js/firebase-config.js"></script>
<script src="js/auth.js"></script>

<script>
function updateAccount(user){
  const notAuth = document.getElementById("notAuth");
  const info = document.getElementById("userInfo");

  if(!user){
    notAuth.style.display = "";
    info.style.display = "none";
    return;
  }

  notAuth.style.display = "none";
  info.style.display = "";

  document.getElementById("userName").textContent =
    user.displayName || "Без имени";
  document.getElementById("userEmail").textContent = user.email || "—";

  if(user.photoURL){
    document.getElementById("userPhoto").src = user.photoURL;
  }else{
    document.getElementById("userPhoto").src = "images/Default-user.png";
  }

  const docs = window.userStorage.all("doc");
  const tpls = window.userStorage.all("tpl");

  document.getElementById("docCount").textContent = docs.length;
  document.getElementById("tplCount").textContent = tpls.length;
}

document.addEventListener("auth-changed", e => {
  updateAccount(e.detail.user);
});

function editProfile(){
  if(!window.CURRENT_USER){
    alert("Вы не авторизованы");
    return;
  }
  const newName = prompt("Введите новое имя:", window.CURRENT_USER.displayName || "");
  if(!newName) return;
  window.CURRENT_USER.updateProfile({displayName: newName})
    .then(()=>location.reload())
    .catch(err => alert("Ошибка обновления: " + err.message));
}
</script>

</body>
</html>


